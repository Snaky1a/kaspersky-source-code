Создание и применение файла дифференса.
=======================================

1. Создание:
------------

makediff.exe <base.bin> <newbase.bin> <diff.bin> [switches]

Cоздает из базового и кодируемого файла файл с дифференсом, с помощью которого
впоследствии можно будет из базового файла получить кодируемый.

Параметры: <base.bin>     - базовый файл
           <newbase.bin>  - кодируемый файл
           <diff.bin>     - файл для дифференса
           [switches]     - ключи: 
                            -s : подписывать файл дифференса с помощью tsigner
                            -s"path" : подписывать файл дифференса, беря полный путь
                                       до tsigner.exe из "path"

Пример: makediff.exe c:\old\avp9907.avc avp9909.avc d:\diff\avp0709.dif -s"\\VINTIK\VirusLib\Tools\Scarabey\tsigner.exe"
Найдет разницу между avp9907.avc и avp9907.avc и запишет ее в avp0709.dif, результат
подпишет выполнив \\VINTIK\VirusLib\Tools\Scarabey\tsigner.exe

Приложение возвращает ноль в случае успешного завершения, или ненулевое значение
в случае ошибки (коды ошибок описаны ниже).

Примечания:
1) Базовый и/или кодируемый файл могут быть как .ave базами так и уже
скомпилированными .avc, в последнем случае они будт распакованы в памяти без
промежуточного копирования на диск.

2) Состояние кодируемого файла (ave/avc) сохряняется в файле-диффереса и будет таким
после применения к базовому. Это необходимо для сохраняния целостности цифровой
подписи.

3) Последние 64 байта кодируемого файла считаются цифровой подписью и вырезаются
из файла до расчета дифференса.

4) Размер базового + кодируемого файла не должнен превышать 16мб

5) Работает медленно и использует много памяти (порядка 256мб)

2. Применение:
--------------

appldiff.exe <base.bin> <diff.bin> <newbase.bin>

Параметры: <base.bin>     - базовый файл
           <diff.bin>     - файл для дифференса
           <newbase.bin>  - файл-результат

Пример: appldiff.exe c:\old\avp9907.avc d:\diff\avp0709.dif avp9909.avc
Создаст из avp9907.avc и файла-дифференса avp0709.dif новый файл avp9907.avc

Приложение возвращает ноль в случае успешного завершения, или ненулевое значение
в случае ошибки (коды ошибок описаны ниже).

Примечания:
1) Работает быстро, памяти необходимо столько чтобы загрузить и распаковать (если
это avc) базовый и результирующий файл, т.е. порядка 6мб для кумулятива.

2) Цифровая подпись берется из файла-дифференса и без изменения прикрепялется к
концу результирующего файла.

3) Совместимость базового файла проверяется только по контрольной сумме, цифровые
подписи не проверяются ни в базовом, ни в файле-дифференса, ни в результирующем.

3. Коды ошибок для makediff.exe/appldiff.exe:
---------------------------------------------
  0 - нет ошибок (нормальное завершение)
 -1 - неправильные аргументы приложения
 -2 - нехватает памяти
 -3 - ошибка файловой операции (открытие/создание/чтение/запись)
 -4 - слишком большой блок (больше 16мб)
 -5 - внутренняя ошибка компрессии
 -6 - поврежденный файл дифференса
 -7 - несовместимая версия файла дифференса и его обработчика
 -8 - ошибка распаковки/запаковки ave <--> avc
 -9 - несовместимая с данным дифференсом версия базового файла (например слишком старая)
-10 - сглючило tsigner.exe
-11 - неверно вычищенные 16-ти битные линки
